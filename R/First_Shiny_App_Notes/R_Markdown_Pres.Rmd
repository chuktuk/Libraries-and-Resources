---
title: "R Markdown Presentation"
author: "Chuck Tucker"
date: "4/22/2020"
output: slidy_presentation
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Creating New Slides

To create a new slide, just create a new heading.

## Some Basics

- Incorporate code inline
  - The result of 2 + 2 is `r 2+2`
  - Use 'r' as the first char inside the backticks

## Ordered Lists

1. Use numbers
2. If you want to create numbered lists that is

## Chunks of code

- Two ways to add code chunks:
1. Can click the *Insert* button to add a code chunk
2. Can do **Ctrl+Alt+i** on a PC or **Cmd+Shift+i** on Mac

## Displaying code in a chunk
- Use argument 'echo = TRUE' to display code + output
- Use argument 'echo = FALSE' to supress code and only display the output

```{r code_chunk_name, echo=FALSE}
print('This was printed by R')

```


## Including CSS

- Add argument `css: file.css` to your preamble to include a css file
- Easiest modications are using HTML tags


## RPubs

- Free way to publish R Markdown documents and presentations
- Publicly available
- Users can comment on the documents
- Click this link -> [RPubs](https://rpubs.com)
- To publish, click the publish button after knitting your document


## Shiny Apps

- This is a basic shiny interactive plot, built-in to the slide
- Shiny apps are not supported in static documents
  - Must add `runtime: shiny` to the preamble to include this functionality
  - The **Knit** button then becomes **Run Presentation**
- Shiny apps have a basic template

## My First Interactive Plot

- Interactive plot allowing you to set the exponent (x^input)

```{r polynomial_plot, echo=FALSE}
library(shiny)
shinyApp(
  ui= fluidPage(     # user interface is a fluidPage, allowing markdown/app to be displayed together
    sliderInput('exponent',      # name for the variable storing the slider value
                label = 'Exponent',     # label for this item on the UI
                min = 1,    # slider parameters including a starting 'value'
                max = 5,
                value = 2),
    plotOutput('polynomialPlot')   # assign name for this object to call in the server argument
  ),
  server = function(input, output) {    # create a function with input/output args
    output$polynomialPlot <- renderPlot(     # output must call renderPlot to be interactive, often need curly braces here
      curve(x^input$exponent, from = -5, to = 5)  # the plotting function using the slider variable
    )
  }
)
```


## Shiny Controls (Widgets)

- The list/code for the different Shiny widgets are available at the link below
- [Shiny Widget Gallery](https://shiny.rstudio.com/gallery/widget-gallery.html)


## Troubleshooting Issues

- Add `print(input$varName)` inside your `renderPlot()` call
  - In the example, this was added before the `curve()` call, but did not have a comma separating the two function calls
  - The input value will not print in the presentation, but it will print in the RStudio console
- e.g. The `selectInput()` select box widget returns a string
  - Solution: use `as.numeric(input$varName)` in your `renderPlot()` call 


## Interdependent Controls

- You may want to update user controls based on other controls
- The dependent controls must be moved to the server side
  - Example on the next slide


## Interdependent Controls Example

```{r hist_plot, echo=FALSE}
shinyApp(
  ui = fluidPage(
    selectInput('no_data',
                label = 'Number of Data Points',
                choices = list('100' = 100, '500' = 500, '1000' = 1000, '5000' = 5000, '10000' = 10000),
                selected = 1000),
    sliderInput('mean',
                label = 'Mean',
                min = -10,
                max = 10,
                value = 0),
    sliderInput('sd',
                label = 'Standard Deviation',
                min = 0,
                max = 5,
                value = 1),
    uiOutput('xmin_slider'),   # create a uiOutput and assign a name to the object for the interdepentent widget
    uiOutput('xmax_slider'),   # can do multiples
    plotOutput('histogram')
  ),
  server = function(input, output){
    
    output$xmin_slider <- renderUI({   # need to render the UI object on the server
      
      if(is.null(input$mean)){  # this statement avoids error messages when initially loading the app
        return()                # good practice to do this for renderUI objects
      }
        
      sliderInput('xmin',
                  label = 'X Min',
                  min = (input$mean - 15),
                  max = (input$mean - 3),
                  value = (input$mean - 3))
      
    })
    
    
    output$xmax_slider <- renderUI({   # need to render the UI object on the server
      
      if(is.null(input$mean)){  # this statement avoids error messages when initially loading the app
        return()                # good practice to do this for renderUI objects
      }
        
      sliderInput('xmax',
                  label = 'X Max',
                  min = (input$mean + 3),
                  max = (input$mean + 15),
                  value = (input$mean + 3))
      
    })
    
    
      
    # appears commas are not required between output objects in the server() function
    
    output$histogram <- renderPlot(     # use curly braces to contain multiple statements in renderPlot
      hist(rnorm(as.numeric(input$no_data), mean=input$mean, sd=input$sd), 
           xlim=c(input$xmin, input$xmax),
           main='Interactive Histogram',
           xlab='Distribution',
           ylab='Frequency')  # still use input$xmin/max here
    )
  }
)

```


## Reactive Expressions

- In the example on the previous slide, the data are regenerated any time the following are changed by the user:
  - Number of Data Points
  - Mean of the Distribution
  - Standard Deviation
  - X Min and X Max
- X Min and X Max should not change the data, but only the scale
  - Use reactive expressions (example next slide) to control this


## Reactive Expressions Example

- Changing X Min and X Max will shift the view but not update the data

```{r reactive_hist_plot, echo=FALSE}
shinyApp(
  ui = fluidPage(
    selectInput('no_data',
                label = 'Number of Data Points',
                choices = list('100' = 100, '500' = 500, '1000' = 1000, '5000' = 5000, '10000' = 10000),
                selected = 1000),
    sliderInput('mean',
                label = 'Mean',
                min = -10,
                max = 10,
                value = 0),
    sliderInput('sd',
                label = 'Standard Deviation',
                min = 0,
                max = 5,
                value = 1),
    uiOutput('xmin_slider'),   
    uiOutput('xmax_slider'),   
    plotOutput('histogram')
  ),
  server = function(input, output){
    
    output$xmin_slider <- renderUI({   # need to render the UI object on the server
      
      if(is.null(input$mean)){  # this statement avoids error messages when initially loading the app
        return()                # good practice to do this for renderUI objects
      }
        
      sliderInput('xmin',
                  label = 'X Min',
                  min = (input$mean - 15),
                  max = (input$mean - 3),
                  value = (input$mean - 3))
      
    })
    
    
    output$xmax_slider <- renderUI({   # need to render the UI object on the server
      
      if(is.null(input$mean)){  # this statement avoids error messages when initially loading the app
        return()                # good practice to do this for renderUI objects
      }
        
      sliderInput('xmax',
                  label = 'X Max',
                  min = (input$mean + 3),
                  max = (input$mean + 15),
                  value = (input$mean + 3))
      
    })
    
    
      
    # appears commas are not required between output objects in the server() function
    
    output$histogram <- renderPlot(     # use curly braces to contain multiple statements in renderPlot
      hist(rnorm(as.numeric(input$no_data), mean=input$mean, sd=input$sd), 
           xlim=c(input$xmin, input$xmax),
           main='Interactive Histogram',
           xlab='Distribution',
           ylab='Frequency')  # still use input$xmin/max here
    )
  }
)

```


## Laying Out Shiny Apps

- Three options for layout
  - sidebarLayout (fluidPage)
    - 2 columns (responsive for mobile devices)
    - will stack vertically when resizing the window
  - tabsetPanel (fliudPage)
    - multiple tabs in the right hand columns
    - includes a sidebarLayout for the left hand column
  - navbarPage (navbarPage)
    - multi-page apps
    
## Sidebar Panel App

- Normal fliudPages are not reponsive, this page is (when slidy_pres)

```{r}
shinyApp(
  ui = fluidPage(
    # adding sidebar layout here
    sidebarLayout(
      # include a sidebar panel here
      sidebarPanel(
        # add your input items here
        sliderInput('no_data', label = 'Number of data points',
                    min = 1000,
                    max = 5000,
                    value = 1000),
        sliderInput('mean', label = 'Mean',
                    min = 0,
                    max = 8,
                    value = 3),
        sliderInput('sd', label = 'Standard Deviation',
                    min = 1,
                    max = 10,
                    value = 2),
        # a sliderInput generated in the server section
        # creates a reactive layout that won't recalculate data when changed
        uiOutput('xlim_ui')
      ),
      # define what is displayed in your main panel here
      mainPanel(plotOutput('histogram'))
    )
  ),
  server = function(input, output){
    
    output$xlim_ui <- renderUI({
      if(is.null(input$no_data)){
        return()
      }
      sliderInput('xlim', label = 'xlim',
                  min = input$mean,
                  max = 10,
                  value = input$mean,
                  step = 1)
    })
    
    data_for_plot <- reactive({
      rnorm(input$no_data, mean = input$mean, sd = input$sd)
    })
    
    output$histogram <- renderPlot({
      if(is.null(input$xlim)){
        return()
      }
      data_for_plot <- data_for_plot()
      hist(data_for_plot, xlim=c(-input$xlim,input$xlim))
    })
  }
)
```


## Tab Set Panel
- Allows for multiple tabs

```{r}
shinyApp(
  ui = fluidPage(
    # can include a sidebar for tab set panels
    sidebarLayout(
      sidebarPanel(
        # add your input items here
        sliderInput('no_data', label = 'Number of data points',
                    min = 1000,
                    max = 5000,
                    value = 1000),
        sliderInput('mean', label = 'Mean',
                    min = 0,
                    max = 8,
                    value = 3),
        sliderInput('sd', label = 'Standard Deviation',
                    min = 1,
                    max = 10,
                    value = 2),
        # a sliderInput generated in the server section
        # creates a reactive layout that won't recalculate data when changed
        uiOutput('xlim_ui')
      ),
      mainPanel(tabsetPanel(  # include a tabsetPanel within your main panel
        # each tab gets a tabPanel
        tabPanel('Histogram',
                 plotOutput('histogram')),
        tabPanel('Data Table',
                 dataTableOutput('data_table'))
      )
    )
  )),
  server = function(input, output){
    
    output$xlim_ui <- renderUI({
      if(is.null(input$mean)){
        return()
      }
      sliderInput("xlim", label = "xlim",
                  min = input$mean,
                  max = 10,
                  value = input$mean,
                  step = 1)
    })
    
    data_for_plot <- reactive({
      rnorm(input$no_data, mean = input$mean, sd = input$sd)
    })
    
    # create the histogram
    output$histogram <- renderPlot({
      if(is.null(input$xlim)){
        return()
      }
      
      data_for_plot <- data_for_plot()
      
      hist(data_for_plot, xlim = c(-input$xlim,input$xlim))
    })
    
    # create the table
    output$data_table <- renderDataTable({
      as.data.frame(data_for_plot())
    })
    
  }
)
```


## Navbar Page
- Multiple pages with a navbar

```{r}
library(shinythemes)
shinyApp(
  # first function of ui is now navbarPage that can include fluidPages
  ui = navbarPage(
    theme = shinytheme('darkly'),
    'Dashboard-like navbarPage', # title
    #can add tabPanels for 'pages' of your app
    # this the first item in the navbarPage app
    tabPanel('Histograms',
    # this can include fluidPages
    fluidPage(sidebarLayout(
      sidebarPanel(
        sliderInput('no_data', label = 'Number of data',
                    min = 1000,
                    max = 5000,
                    value = 1000),
        sliderInput('mean', label = 'Mean',
                    min = 0,
                    max = 8,
                    value = 3),
        sliderInput('sd', label = 'Standard Deviation',
                    min = 1,
                    max = 10,
                    value = 2),
        # a sliderInput generated in the server section
        # creates a reactive layout that won't recalculate data when changed
        uiOutput('xlim_ui')
      ),
      mainPanel(plotOutput('histogram'))
    ))
    ),
    # create a navbar menu
    # this is the second item on the navbarPage, which has links to two separate 'views' or 'pages'
    navbarMenu(
      'Menu item with Children',
      # this menu has tabPanels that are fluidPages
      # each of these tab panels is actually a page accessed by clicking on the title in a dropdown menu
      tabPanel('Child One',
               fluidPage(plotOutput('curve1')
                         )
               ),
      tabPanel('Child Two',
               fluidPage(plotOutput('curve2')
                         )
               )
    ), collapsible = TRUE  # allow the menu to collapse (to a hamburger if window size dictates)
    # collapsible is an arg of navbarPage that affects its responsiveness, it does not apply to navbarMenu
  ),
  
  server = function(input, output){
    
    output$xlim_ui <- renderUI({
      if(is.null(input$mean)){
        return()
      }
      sliderInput("xlim", label = "xlim",
                  min = input$mean,
                  max = 10,
                  value = input$mean,
                  step = 1)
    })
    
    data_for_plot <- reactive({
      rnorm(input$no_data, mean = input$mean, sd = input$sd)
    })
    
    output$histogram <- renderPlot({
      if(is.null(input$xlim)){
        return()
      }
      
      data_for_plot <- data_for_plot()
      
      hist(data_for_plot, xlim = c(-input$xlim,input$xlim))
    })
    
    output$curve1 <- renderPlot({
      curve(x^1, from = -5, to = 5)
    })
    
    output$curve2 <- renderPlot({
      curve(x^2, from = -5, to = 5)
    })
  } 
)
```

## Shiny Themes

- allow you to customize shiny apps appearance without using css
- see [Shiny Themes](https://rstudio.github.io/shinythemes/)
- must first make sure shinythemes library is installed
- simply include the library in the app, and add `theme = shinytheme('themName')` to ui items to format
- this was done to the previous app using navbarPage
